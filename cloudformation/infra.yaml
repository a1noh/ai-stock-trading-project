AWSTemplateFormatVersion: "2010-09-09"
Description: "AI Stock Trading Infrastructure"

Resources:
  # S3 Buckets for Stock Data (Raw and Processed Storage)
  StockDataBucketRaw:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub "ai-stock-trading-bucket-raw-${AWS::AccountId}-${AWS::Region}"
      AccessControl: Private
      VersioningConfiguration:
        Status: Enabled

  StockDataBucketProcessed:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub "ai-stock-trading-bucket-processed-${AWS::AccountId}-${AWS::Region}"
      AccessControl: Private
      VersioningConfiguration:
        Status: Enabled

  # Lambda Function for Data Collection
  AiStockTradingLambdaFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: AiStockTradingDataCollectionFunction
      Handler: index.handler
      Role: !Sub arn:aws:iam::${AWS::AccountId}:role/AiStockTradingLambdaRole
      Code:
        S3Bucket: !Ref StockDataBucketRaw
        S3Key: code/lambda.zip
      Runtime: nodejs16.x
      Timeout: 300

  # # API Gateway for Trade Execution
  # AiStockTradingApiGateway:
  #   Type: AWS::ApiGateway::RestApi
  #   Properties:
  #     Name: AiStockTradingApi
  #     Description: API for executing trades

  # # EventBridge Rule for Lambda Invocation
  # AiStockTradingEventBridgeRule:
  #   Type: AWS::Events::Rule
  #   Properties:
  #     Name: AiStockTradingEventBridgeRule
  #     EventPattern:
  #       Source:
  #         - "aws.s3"
  #     Targets:
  #       - Arn: !GetAtt AiStockTradingLambdaFunction.Arn
  #         Id: "AiStockTradingLambdaTarget"

  # # SageMaker Model for AI Trading
  # AiStockTradingSageMakerModel:
  #   Type: AWS::SageMaker::Model
  #   Properties:
  #     ExecutionRoleArn: !Sub arn:aws:iam::${AWS::AccountId}:role/AiStockTradingSageMakerRole
  #     PrimaryContainer:
  #       Image: "123456789012.dkr.ecr.us-east-1.amazonaws.com/ai-stock-model:latest"
  #       ModelDataUrl: "s3://ai-stock-trading-bucket-raw/model/model.tar.gz"

  # # SageMaker Endpoint Config for Model Inference
  # AiStockTradingSageMakerEndpointConfig:
  #   Type: AWS::SageMaker::EndpointConfig
  #   Properties:
  #     EndpointConfigName: AiStockTradingEndpointConfig
  #     ProductionVariants:
  #       - VariantName: AllTraffic
  #         ModelName: !Ref AiStockTradingSageMakerModel
  #         InitialInstanceCount: 1
  #         InstanceType: ml.m5.large

  # # SageMaker Endpoint for Model Inference
  # AiStockTradingSageMakerEndpoint:
  #   Type: AWS::SageMaker::Endpoint
  #   Properties:
  #     EndpointName: AiStockTradingEndpoint
  #     EndpointConfigName: !Ref AiStockTradingSageMakerEndpointConfig

  # # CloudWatch Log Group for Lambda Function Monitoring
  # AiStockTradingCloudWatchLogGroup:
  #   Type: AWS::Logs::LogGroup
  #   Properties:
  #     LogGroupName: "/aws/lambda/AiStockTradingDataCollectionFunction"

  # # Kinesis Stream for Real-Time Data
  # AiStockTradingKinesisStream:
  #   Type: AWS::Kinesis::Stream
  #   Properties:
  #     Name: AiStockTradingKinesisStream
  #     ShardCount: 1

  # # Glue Job for Data Processing
  # AiStockTradingGlueJob:
  #   Type: AWS::Glue::Job
  #   Properties:
  #     Name: AiStockTradingGlueJob
  #     Role: !Sub arn:aws:iam::${AWS::AccountId}:role/AiStockTradingGlueRole
  #     Command:
  #       Name: "glueetl"
  #       ScriptLocation: "s3://ai-stock-trading-bucket-processed/glue-script.py"
  #     MaxCapacity: 2

  # # SNS Topic for Notifications
  # AiStockTradingSnsTopic:
  #   Type: AWS::SNS::Topic
  #   Properties:
  #     DisplayName: AiStockTradingNotifications

 

Outputs:
  StockDataBucketRaw:
    Value: !Ref StockDataBucketRaw
    Description: "Raw S3 Bucket for Stock Data"

  StockDataBucketProcessed:
    Value: !Ref StockDataBucketProcessed
    Description: "Processed S3 Bucket for Stock Data"

  AiStockTradingLambdaFunction:
    Value: !GetAtt AiStockTradingLambdaFunction.Arn
    Description: "Lambda Function for Data Collection"

  # AiStockTradingApiGateway:
  #   Value: !Ref AiStockTradingApiGateway
  #   Description: "API Gateway for Trade Execution"

  # AiStockTradingSageMakerEndpoint:
  #   Value: !Ref AiStockTradingSageMakerEndpoint
  #   Description: "SageMaker Endpoint for Model Inference"

  # AiStockTradingCloudWatchLogGroup:
  #   Value: !Ref AiStockTradingCloudWatchLogGroup
  #   Description: "CloudWatch Log Group for Lambda Function"

  # AiStockTradingKinesisStream:
  #   Value: !Ref AiStockTradingKinesisStream
  #   Description: "Kinesis Stream for Real-Time Data"

  # AiStockTradingGlueJob:
  #   Value: !Ref AiStockTradingGlueJob
  #   Description: "Glue Job for Data Processing"

  # AiStockTradingSnsTopic:
  #   Value: !Ref AiStockTradingSnsTopic
  #   Description: "SNS Topic for Notifications"
